{"version":3,"sources":["webpack:///./src/views/PublishPost.vue","webpack:///./src/views/PublishPost.vue?dacd","webpack:///./src/utils/validation.js","webpack:///./src/api/image.js"],"names":["_createElementVNode","class","style","for","_createElementBlock","_hoisted_1","_hoisted_4","_ctx","$event","type","name","placeholder","_hoisted_7","id","accept","onChange","src","_toDisplayString","onClick","defineComponent","setup","store","useStore","content","ref","uploadImageRes","file","reactive","fs","thumbnail","size","unit","title","preViewImage","errorImageMessageVised","errorImageMessage","errorContentMessageVised","errorContentMessage","errorMessageEnum","noContent","imageSizeError","imageTypeError","showFile","async","e","target","files","console","log","window","URL","createObjectURL","value","imageTypeRule","uploadImage","submitPost","userId","getters","_id","status","data","dispatch","imgUrl","imageUrl","router","push","path","error","__exports__","render","nicknameRule","nickname","length","emailRule","email","test","passwordRule","password","confirmPasswordRule","confirmPassword","filename","formData","FormData","append","request","url","method"],"mappings":"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","file":"js/chunk-cdf129d6.0ce70a5f.js","sourcesContent":["<template>\n  <div>\n    <div class=\"block-title\">\n      張貼動態\n    </div>\n    <div class=\"draft-post\">\n      <div class=\"draft-post__post\">\n        <p class=\"draft-post__post__label\">貼文內容</p>\n        <div class=\"draft-post__textarea\">\n          <textarea v-model=\"content\" type=\"text\" name=\"nickname\" placeholder=\"輸入您的貼文內容稱\"></textarea>\n        </div>\n      </div>\n      <div style=\"margin-top: 16px\">\n        <label for=\"upload\" class=\"text-btn black\">上傳圖片</label>\n        <input id=\"upload\" style=\"visibility:hidden\" type=\"file\" accept=\"image/png, image/gif, image/jpeg\" @change=\"showFile\">\n      </div>\n      <img v-if=\"preViewImage\" class=\"draft-post__img\" style=\"margin-top: 16px\" :src=\"preViewImage\"/>\n      <div v-else class=\"draft-post__img\" />\n\n      <!-- 錯誤訊息 -->\n      <p v-if=\"errorImageMessageVised\" class=\"error-message\">{{ errorImageMessage }}</p>\n      <p v-if=\"errorContentMessageVised\" class=\"error-message\">\n        {{ errorContentMessage }}\n      </p>\n      <div style=\"max-width: 323px margin: 0 auto\">\n        <button style=\"margin-top: 32px\" class=\"btn secondary\" @click=\"submitPost\"> 送出貼文\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport { defineComponent, reactive, ref } from 'vue'\nimport { imageTypeRule } from '@/utils/validation'\nimport { useStore } from 'vuex'\nimport { uploadImage } from '@/api/image.js'\nimport router from '../router';\n\nexport default defineComponent({\n  name: 'PublishPost',\n  setup () {\n    const store = useStore();\n    const content = ref('')\n    let file = reactive({})\n    let fs = reactive({\n      name: '', // input 的圖檔名稱\n      thumbnail: null, // input 的圖片縮圖\n      size: null, // input 的圖片大小\n      unit: 'KB',\n    })\n    let title = ref('') // 圖片標題\n    let preViewImage = ref(null) // 圖片預覽\n    let errorImageMessageVised = ref(true)\n    let errorImageMessage = ref('')\n    let errorContentMessageVised = ref(true)\n    let errorContentMessage = ref('')   \n    let uploadImageRes;\n    const errorMessageEnum = {\n      noContent: '沒有貼文內容，請填寫',\n      imageSizeError: '圖片檔案過大，僅限 1mb 以下檔案',\n      imageTypeError: '圖片格式錯誤，僅限 JPG、PNG 圖片',\n    }\n    const showFile = async(e) =>{\n      file = e.target.files[0]\n      console.log('showFile',file)\n      fs.name = file.name // input 的圖檔名稱\n      fs.thumbnail = window.URL.createObjectURL(file) // input 的圖片縮圖\n      fs.size = ~~(file.size * 0.001) // input 的圖片大小\n      title.value = fs.name // 預設 input 的圖檔名稱為圖片上傳時的圖片標題\n      preViewImage.value = URL.createObjectURL(file)\n\n      if (fs.size > 1000) {\n        errorImageMessageVised.value = true\n        errorImageMessage.value = errorMessageEnum.imageSizeError\n      } else if (!imageTypeRule(fs.name)) {\n        errorImageMessageVised.value = true\n        errorImageMessage.value = errorMessageEnum.imageTypeError\n      } else {\n        errorImageMessageVised.value = false\n      }\n\n      uploadImageRes = await uploadImage(file)\n      console.log('uploadImageRes',uploadImageRes)\n    }\n    \n    const submitPost = async () =>{\n      try {\n        console.log('submitPost')\n        errorContentMessageVised.value = false;\n\n        if (content.value === '') {\n          errorContentMessageVised.value = true;\n          errorContentMessage.value = errorMessageEnum.noContent;\n          return false;\n        }\n\n        if (errorImageMessageVised.value) {\n          return false;\n        }\n        \n        const userId = store.getters['user/userProfile']?._id; \n        const { status, data } = await store.dispatch('post/addPost', {\n          userId,\n          content: content.value,\n          imgUrl: uploadImageRes.data.imageUrl\n        });\n        console.log(status,data)\n        status === 'success' && router.push({ path: '/home' });\n\n      } catch (error) {\n        \n      }\n    }\n    return {\n      content,\n      title,\n      preViewImage,\n      errorImageMessageVised,\n      errorImageMessage,\n      errorContentMessageVised,\n      errorContentMessage,\n      showFile,\n      submitPost\n    }\n  }\n\n})\n</script>\n","import { render } from \"./PublishPost.vue?vue&type=template&id=337e6fe4\"\nimport script from \"./PublishPost.vue?vue&type=script&lang=js\"\nexport * from \"./PublishPost.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/uniza/WorkSpace/github/vue3-wall/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","/** 暱稱驗證\n * @desc 暱稱驗證\n * @param { nickname } string - nickname text\n * @return { boolean } boolean - 判斷是否符合規則或不符合規則的訊息\n */\nexport const nicknameRule = (nickname) => {\n  return nickname.length >= 2\n}\n\n/** 電子郵件驗證\n * @desc 電子郵件驗證\n * @param { email } string - email text\n * @return { boolean } boolean - 判斷是否符合規則或不符合規則的訊息\n */\nexport const emailRule = (email) => {\n  return /.+@.+\\..+/.test(email)\n}\n\n/** 密碼驗證\n * @desc 密碼驗證\n * @param { password } string - password text\n * @return { boolean } boolean - 判斷是否符合規則或不符合規則的訊息\n */\nexport const passwordRule = (password) => {\n  return /^((?=\\S*?[A-Za-z])(?=\\S*?[0-9]).{7,})\\S$/.test(password)\n}\n\nexport const confirmPasswordRule = (password,confirmPassword) => {\n  console.log(password==confirmPassword)\n  return password == confirmPassword\n}\n\n/** 圖片格式驗證\n * @desc 密碼驗證\n * @param { filename } string - image test\n * @return { boolean } boolean - 驗證通過回傳 true, 否則 false\n */\nexport const imageTypeRule = (filename) => {\n  return /\\.(jpg|png|JPG|PNG|jpeg)$/.test(filename)\n}\n","import request from \"@/utils/request\";\n\nexport function uploadImage(file) {\n  console.log('uploadImage', file)\n  const formData = new FormData();\n  formData.append('file',file)\n\n  return request({\n    url: '/files/uploadImage',\n    method: 'POST',\n    data: formData,\n  })\n}\n\n"],"sourceRoot":""}